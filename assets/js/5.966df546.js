(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{195:function(e,s,t){"use strict";t.r(s);var a=t(0),r=Object(a.a)({},function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"将-net-core-部署到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将-net-core-部署到服务器","aria-hidden":"true"}},[e._v("#")]),e._v(" 将 .Net Core 部署到服务器")]),e._v(" "),t("h2",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境","aria-hidden":"true"}},[e._v("#")]),e._v(" 环境")]),e._v(" "),t("ol",[t("li",[e._v("Linux 系统：Centos 7")])]),e._v(" "),t("h2",{attrs:{id:"安装-net-core-sdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-net-core-sdk","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装 .Net Core SDK")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://dotnet.microsoft.com/download",target:"_blank"}},[e._v("官方地址")])]),e._v(" "),t("p",[e._v("使用命令行测试是否成功执行")]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("donnet 项目名.dll\n")])])]),t("h2",{attrs:{id:"守护进程-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#守护进程-supervisor","aria-hidden":"true"}},[e._v("#")]),e._v(" 守护进程 Supervisor")]),e._v(" "),t("p",[e._v("当我们关闭远程连接时，控制台窗口也随之关闭，为了让我们发布的项目能一直运行，安装 Supervisor 来守护我们的进程")]),e._v(" "),t("h3",{attrs:{id:"安装-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-supervisor","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装 Supervisor")]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yum install python-setuptools\neasy_install supervisor\n")])])]),t("h3",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[e._v("#")]),e._v(" 配置")]),e._v(" "),t("ul",[t("li",[e._v("创建配置文件")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mkdir /etc/supervisor\n\necho_supervisord_conf > /etc/supervisor/supervisord.conf\n")])])]),t("ul",[t("li",[e._v("修改 supervisord.conf 文件，在文件最后面修改为如下")])]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[include]\nfiles = /etc/supervisor/conf.d/*.conf\n")])])]),t("ul",[t("li",[e._v("创建对项目的守护")])]),e._v(" "),t("p",[e._v("在 /etc/supervisor/conf.d 下创建文件 MyPlat.conf")]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[program:MyPlat]\ncommand=dotnet MyPlat.dll\ndirectory=/root/web/MyPlat/\nautorestart=true ;是否自动重启\nstderr_logfile=/var/log/supervisord/web/MyPlat.err.log ;文件目录记得创建，不然会报错\nstdout_logfile=/var/log/supervisord/web/MyPlat.out.log\nenvironment=ASPNETCORE_ENVIRONMENT=Production ;进程环境变量\nuser=root\nstopsignal=INT\n")])])]),t("ul",[t("li",[e._v("启动 supervisor 配置文件")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("supervisord -c /etc/supervisor/supervisord.conf\n")])])]),t("ul",[t("li",[e._v("查看进程")])]),e._v(" "),t("p",[e._v("如果存在 donnet MyPlat.dll,则表示启动成功")]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ps -ef | grep MyPlat\n")])])]),t("ul",[t("li",[e._v("配置 supervisor 开机启动")])]),e._v(" "),t("p",[e._v("创建文件 supervisord.service，")]),e._v(" "),t("p",[e._v("拷贝到 /usr/lib/systemd/system/supervisord.service，")]),e._v(" "),t("p",[e._v("执行命令 systemctl enable supervisord")]),e._v(" "),t("p",[e._v("执行命令：systemctl is-enabled supervisord #来验证是否为开机启动")]),e._v(" "),t("div",{staticClass:"language-service extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# dservice for systemd (CentOS 7.0+)\n# by ET-CS (https://github.com/ET-CS)\n[Unit]\nDescription=Supervisor daemon\n\n[Service]\nType=forking\nExecStart=/usr/bin/supervisord -c /etc/supervisor/supervisord.conf\nExecStop=/usr/bin/supervisorctl shutdown\nExecReload=/usr/bin/supervisorctl reload\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n\n[Install]\nWantedBy=multi-user.target\n")])])]),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令","aria-hidden":"true"}},[e._v("#")]),e._v(" 常用命令")]),e._v(" "),t("ul",[t("li",[e._v("重启配置文件")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("supervisorctl reload\n")])])]),t("h2",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx","aria-hidden":"true"}},[e._v("#")]),e._v(" Nginx")]),e._v(" "),t("p",[e._v("当我们部署多个项目的时候，不可能部署一个项目，服务器便要开启一个端口，这时候安装 Nginx 来负责 80 端口的监控，然后负责对多个项目的分发。")]),e._v(" "),t("h3",{attrs:{id:"安装-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-nginx","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装 Nginx")]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl -o  nginx.rpm http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\nrpm -ivh nginx.rpm\nyum install nginx\n")])])]),t("h3",{attrs:{id:"配置对项目的转发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置对项目的转发","aria-hidden":"true"}},[e._v("#")]),e._v(" 配置对项目的转发")]),e._v(" "),t("p",[e._v("将 /etc/nginx/conf.d/default.conf 的内容替换如下，然后重启 Nginx")]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("server {\n    listen       80;\n    server_name  www.baidu.com ;你的网站地址\n\n    location / {\n        proxy_pass http://localhost:8080/ ;本地访问地址\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection keep-alive;\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n")])])]),t("h3",{attrs:{id:"nginx-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-常用命令","aria-hidden":"true"}},[e._v("#")]),e._v(" Nginx 常用命令")]),e._v(" "),t("ul",[t("li",[e._v("启动")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl start nginx\n")])])]),t("ul",[t("li",[e._v("开机启动")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl enable nginx\n")])])]),t("ul",[t("li",[e._v("重启配置")])]),e._v(" "),t("div",{staticClass:"language-Linux extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("nginx -s reload\n")])])])])},[],!1,null,null,null);s.default=r.exports}}]);